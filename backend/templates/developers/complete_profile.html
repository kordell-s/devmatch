{% extends "base.html" %}
{% load static %}

{% block title %}Complete Your Profile - DevMatch{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <!-- Progress indicator -->
            <div class="card mb-4">
                <div class="card-body text-center">
                    <h2>Welcome to DevMatch!</h2>
                    <p class="lead">Complete your profile to get discovered by recruiters</p>
                    <div class="progress mb-3" style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 33%" aria-valuenow="33"
                            aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted">Step 1 of 3: Basic Information</small>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3><i class="bi bi-person-fill me-2"></i>Complete Your Developer Profile</h3>
                    <p class="mb-0 text-muted">Fill out the information below to create your professional profile</p>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" id="profile-form">
                        {% csrf_token %}

                        <!-- Basic Information Section -->
                        <div class="mb-4">
                            <h4 class="border-bottom pb-2"><i class="bi bi-info-circle me-2"></i>Basic Information</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.profile_picture.label_tag }}
                                        {{ form.profile_picture }}
                                        {% if form.profile_picture.help_text %}
                                        <div class="form-text">{{ form.profile_picture.help_text }}</div>
                                        {% endif %}
                                        {% if form.profile_picture.errors %}
                                        <div class="text-danger">{{ form.profile_picture.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.location.label_tag }} <span class="text-danger">*</span>
                                        {{ form.location }}
                                        {% if form.location.errors %}
                                        <div class="text-danger">{{ form.location.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form.bio.label_tag }} <span class="text-danger">*</span>
                                {{ form.bio }}
                                {% if form.bio.help_text %}
                                <div class="form-text">{{ form.bio.help_text }}</div>
                                {% endif %}
                                {% if form.bio.errors %}
                                <div class="text-danger">{{ form.bio.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                {{ form.skills.label_tag }} <span class="text-danger">*</span>
                                <div class="skills-container"
                                    style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 15px; background-color: #f8f9fa;">
                                    <div class="row">
                                        {% for choice in form.skills %}
                                        <div class="col-md-6 col-lg-4 mb-2">
                                            <div class="form-check">
                                                {{ choice.tag }}
                                                <label class="form-check-label" for="{{ choice.id_for_label }}">
                                                    {{ choice.choice_label }}
                                                </label>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% if form.skills.help_text %}
                                <div class="form-text">{{ form.skills.help_text }}</div>
                                {% endif %}
                                {% if form.skills.errors %}
                                <div class="text-danger">{{ form.skills.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="mb-3">
                                {{ form.experience.label_tag }}
                                {{ form.experience }}
                                {% if form.experience.help_text %}
                                <div class="form-text">{{ form.experience.help_text }}</div>
                                {% endif %}
                                {% if form.experience.errors %}
                                <div class="text-danger">{{ form.experience.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Contact Information Section -->
                        <div class="mb-4">
                            <h4 class="border-bottom pb-2"><i class="bi bi-telephone me-2"></i>Contact Information</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.email.label_tag }}
                                        {{ form.email }}
                                        {% if form.email.errors %}
                                        <div class="text-danger">{{ form.email.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.phone.label_tag }}
                                        {{ form.phone }}
                                        {% if form.phone.errors %}
                                        <div class="text-danger">{{ form.phone.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Professional Links Section -->
                        <div class="mb-4">
                            <h4 class="border-bottom pb-2"><i class="bi bi-link-45deg me-2"></i>Professional Links</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.github_url.label_tag }}
                                        {{ form.github_url }}
                                        {% if form.github_url.errors %}
                                        <div class="text-danger">{{ form.github_url.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.portfolio_url.label_tag }}
                                        {{ form.portfolio_url }}
                                        {% if form.portfolio_url.errors %}
                                        <div class="text-danger">{{ form.portfolio_url.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                {{ form.linkedin_url.label_tag }}
                                {{ form.linkedin_url }}
                                {% if form.linkedin_url.help_text %}
                                <div class="form-text">{{ form.linkedin_url.help_text }}</div>
                                {% endif %}
                                {% if form.linkedin_url.errors %}
                                <div class="text-danger">{{ form.linkedin_url.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Documents Section -->
                        <div class="mb-4">
                            <h4 class="border-bottom pb-2"><i class="bi bi-file-earmark-text me-2"></i>Documents
                                (Optional)</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.resume.label_tag }}
                                        {{ form.resume }}
                                        {% if form.resume.help_text %}
                                        <div class="form-text">{{ form.resume.help_text }}</div>
                                        {% endif %}
                                        {% if form.resume.errors %}
                                        <div class="text-danger">{{ form.resume.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        {{ form.video_intro.label_tag }}
                                        {{ form.video_intro }}
                                        {% if form.video_intro.help_text %}
                                        <div class="form-text">{{ form.video_intro.help_text }}</div>
                                        {% endif %}
                                        {% if form.video_intro.errors %}
                                        <div class="text-danger">{{ form.video_intro.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="button" class="btn btn-outline-secondary me-md-2" onclick="skipForNow()">
                                Skip for Now
                            </button>
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-check-circle me-2"></i>Complete Profile
                            </button>
                        </div>
                    </form>

                    {% if form.errors %}
                    <div class="alert alert-danger mt-3">
                        <h5><i class="bi bi-exclamation-triangle me-2"></i>Please correct the following errors:</h5>
                        {{ form.errors }}
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function skipForNow() {
        if (confirm('Are you sure you want to skip profile completion? You can always complete it later from your profile settings.')) {
            window.location.href = "{% url 'developers-list' %}";
        }
    }

    // Auto-save progress indicator
    document.getElementById('profile-form').addEventListener('input', function () {
        updateProgress();
    });

    function updateProgress() {
        const form = document.getElementById('profile-form');
        const inputs = form.querySelectorAll('input, textarea, select');
        let filledCount = 0;

        inputs.forEach(input => {
            if (input.type === 'file') {
                if (input.files && input.files.length > 0) filledCount++;
            } else if (input.type === 'checkbox') {
                if (input.checked) filledCount++;
            } else if (input.value.trim() !== '') {
                filledCount++;
            }
        });

        const percentage = Math.round((filledCount / inputs.length) * 100);
        const progressBar = document.querySelector('.progress-bar');
        progressBar.style.width = percentage + '%';
        progressBar.setAttribute('aria-valuenow', percentage);
    }

    // Add search functionality for skills
    function addSkillsSearch() {
        const skillsContainer = document.querySelector('.skills-container');
        const searchInput = document.createElement('input');
        searchInput.type = 'text';
        searchInput.className = 'form-control mb-3';
        searchInput.placeholder = 'Search skills...';

        skillsContainer.insertBefore(searchInput, skillsContainer.firstChild);

        searchInput.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const checkboxes = skillsContainer.querySelectorAll('.form-check');

            checkboxes.forEach(checkbox => {
                const label = checkbox.querySelector('label').textContent.toLowerCase();
                if (label.includes(searchTerm)) {
                    checkbox.style.display = 'block';
                } else {
                    checkbox.style.display = 'none';
                }
            });
        });
    }

    // Initialize skills search when page loads
    document.addEventListener('DOMContentLoaded', addSkillsSearch);
</script>
{% endblock %}